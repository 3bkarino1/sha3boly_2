<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سولي — مغامرة شعاع الشمس الصغير</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* المتغيرات الأساسية المحسنة */
        :root {
            --primary-color: #FFA500;
            --primary-dark: #E69500;
            --primary-light: #FFD580;
            --secondary-color: #4A90E2;
            --secondary-dark: #3A7BC8;
            --accent-color: #FF6B6B;
            --accent-dark: #E55A5A;
            --success-color: #4CAF50;
            --text-color: #333;
            --text-light: #666;
            --bg-color: #FFF;
            --bg-light: #F5F5F5;
            --bg-lighter: #FAFAFA;
            --border-color: #E0E0E0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --border-radius-lg: 20px;
            --transition: all 0.3s ease;
            --transition-fast: all 0.15s ease;
            
            /* ألوان وضع التباين العالي */
            --hc-bg: #000;
            --hc-text: #FFF;
            --hc-primary: #FFFF00;
            --hc-border: #FFF;
        }

        /* وضع التباين العالي المحسن */
        body.high-contrast {
            --bg-color: var(--hc-bg);
            --text-color: var(--hc-text);
            --primary-color: var(--hc-primary);
            --border-color: var(--hc-border);
            --bg-light: #111;
            --bg-lighter: #222;
            --shadow: 0 0 0 2px var(--hc-border);
            --shadow-lg: 0 0 0 4px var(--hc-border);
        }

        /* إعدادات عامة محسنة */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        /* تحسينات للوصول */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* زر التباين العالي المحسن */
        .a11y-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--primary-color);
            border: 2px solid var(--bg-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .a11y-toggle:hover, .a11y-toggle:focus {
            transform: scale(1.1);
            outline: none;
            box-shadow: var(--shadow-lg);
        }

        /* الهيدر والتقدم المحسن */
        .story-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        body.high-contrast .story-header {
            background: rgba(0, 0, 0, 0.9);
        }

        .header-nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skip-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .skip-btn:hover, .skip-btn:focus {
            background: var(--primary-color);
            transform: translateY(-2px);
            outline: none;
            box-shadow: var(--shadow);
        }

        .progress-container {
            flex: 1;
            max-width: 600px;
            margin: 0 20px;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 16.66%; /* المشهد الأول */
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .scene-indicators {
            display: flex;
            justify-content: space-between;
        }

        .scene-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--bg-light);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .scene-dot.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            transform: scale(1.2);
        }

        .scene-dot.completed::before {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        /* المحتوى الرئيسي المحسن */
        .story-main {
            margin-top: 100px;
            min-height: calc(100vh - 100px);
        }

        .story-scene {
            display: none;
            min-height: calc(100vh - 100px);
            padding: 40px 20px;
            position: relative;
        }

        .story-scene.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scene-content {
            max-width: 1200px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .scene-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .visual-container {
            position: relative;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            background: var(--bg-lighter);
        }

        .lottie-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fallback-svg {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: var(--transition);
        }

        .visual-container:hover .fallback-svg {
            transform: scale(1.05);
        }

        .text-container {
            padding: 20px;
            background: var(--bg-color);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
        }

        .scene-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            position: relative;
            display: inline-block;
        }

        .scene-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            right: 0;
            width: 50%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), transparent);
            border-radius: 2px;
        }

        @media (max-width: 768px) {
            .scene-title {
                font-size: 2rem;
            }
        }

        /* عناصر التحكم بالصوت المحسنة */
        .audio-controls {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .play-btn {
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .play-btn:hover, .play-btn:focus {
            background: var(--primary-dark);
            transform: scale(1.05);
            outline: none;
            box-shadow: var(--shadow-lg);
        }

        .audio-waveform {
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            height: 40px;
            background: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 0 10px;
        }

        .waveform-bar {
            width: 6px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 3px;
            animation: waveform 1.5s ease-in-out infinite;
            transform-origin: bottom;
        }

        .waveform-bar:nth-child(2) {
            animation-delay: 0.2s;
        }

        .waveform-bar:nth-child(3) {
            animation-delay: 0.4s;
        }

        .waveform-bar:nth-child(4) {
            animation-delay: 0.6s;
        }

        .waveform-bar:nth-child(5) {
            animation-delay: 0.8s;
        }

        @keyframes waveform {
            0%, 100% {
                height: 20px;
            }
            50% {
                height: 40px;
            }
        }

        /* الترجمة المحسنة */
        .captions {
            background: var(--bg-light);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
            line-height: 1.8;
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
        }

        .captions.highlight {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* النقاط التفاعلية المحسنة */
        .hotspot-area {
            position: relative;
            height: 100px;
        }

        .hotspot {
            position: absolute;
            background: var(--accent-color);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            animation: pulse 2s infinite;
            box-shadow: var(--shadow);
        }

        .hotspot:hover, .hotspot:focus {
            transform: scale(1.2);
            outline: none;
            box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.4);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
            }
        }

        /* بطاقات المعلومات التفاعلية المحسنة */
        .hotspot-card {
            position: absolute;
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-lg);
            max-width: 300px;
            z-index: 10;
            display: none;
            border-top: 4px solid var(--accent-color);
            animation: cardAppear 0.3s ease-out;
        }

        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        body.high-contrast .hotspot-card {
            background: var(--hc-bg);
            border: 2px solid var(--hc-border);
        }

        .hotspot-card h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .close-hotspot {
            position: absolute;
            top: 10px;
            left: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-hotspot:hover, .close-hotspot:focus {
            background: var(--bg-light);
            color: var(--text-color);
            outline: none;
        }

        /* لعبة بناء الدرع المحسنة */
        .minigame-container {
            background: var(--bg-light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            border: 2px dashed var(--border-color);
            transition: var(--transition);
        }

        .minigame-container.active {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .minigame-container h3 {
            margin-bottom: 15px;
            text-align: center;
            color: var(--primary-color);
        }

        .shield-parts {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .shield-part {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            cursor: grab;
            text-align: center;
            min-width: 100px;
            transition: var(--transition);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .shield-part::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.5);
        }

        .shield-part:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .shield-part.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .shield-assembly {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .assembly-area {
            width: 100%;
            transition: var(--transition);
        }

        .assembly-area.complete {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--success-color);
        }

        .shield-fallback {
            display: none;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .no-drag .shield-fallback {
            display: flex;
        }

        .shield-step {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .shield-step:hover, .shield-step:focus {
            background: var(--secondary-dark);
            transform: translateY(-2px);
            outline: none;
            box-shadow: var(--shadow);
        }

        /* أهداف الطاقة المحسنة */
        .energy-targets {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .energy-target {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .energy-target:hover, .energy-target:focus {
            background: var(--primary-color);
            transform: scale(1.2);
            outline: none;
        }

        .energy-target.active {
            background: var(--accent-color);
            animation: targetGlow 1s infinite;
        }

        .energy-target.hit {
            background: var(--success-color);
            animation: hitPulse 0.5s;
        }

        @keyframes targetGlow {
            0%, 100% {
                box-shadow: 0 0 5px var(--accent-color);
            }
            50% {
                box-shadow: 0 0 20px var(--accent-color);
            }
        }

        @keyframes hitPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.5);
            }
            100% {
                transform: scale(1);
            }
        }

        /* احتفال النجاح المحسن */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease;
        }

        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        .success-message {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius-lg);
            text-align: center;
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            animation: bounceIn 0.6s ease;
            max-width: 90%;
            width: 400px;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        body.high-contrast .success-message {
            background: var(--hc-bg);
            border: 2px solid var(--hc-border);
        }

        /* أزرار النداء للعمل المحسنة */
        .final-cta {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .cta-btn {
            padding: 15px 25px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .cta-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: var(--transition);
        }

        .cta-btn:hover::before {
            left: 100%;
        }

        .download-btn {
            background: var(--primary-color);
            color: white;
        }

        .download-btn:hover, .download-btn:focus {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            outline: none;
        }

        .quiz-btn {
            background: var(--secondary-color);
            color: white;
        }

        .quiz-btn:hover, .quiz-btn:focus {
            background: var(--secondary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            outline: none;
        }

        .replay-btn {
            background: var(--accent-color);
            color: white;
        }

        .replay-btn:hover, .replay-btn:focus {
            background: var(--accent-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            outline: none;
        }

        /* عناصر التحكم للجوال المحسنة */
        .mobile-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            transition: var(--transition);
        }

        body.high-contrast .mobile-controls {
            background: rgba(0, 0, 0, 0.9);
        }

        .mobile-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-color);
            transition: var(--transition);
        }

        .mobile-btn:hover, .mobile-btn:focus {
            background: var(--primary-color);
            color: white;
            outline: none;
            transform: scale(1.1);
        }

        /* النص الكامل المحسن */
        .transcript-section {
            padding: 60px 20px;
            background: var(--bg-light);
        }

        .transcript-section h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        .transcript-content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        body.high-contrast .transcript-content {
            background: var(--hc-bg);
            border: 2px solid var(--hc-border);
        }

        .transcript-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .transcript-content p:hover {
            background: var(--bg-light);
        }

        .back-to-top {
            display: block;
            margin: 30px auto 0;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .back-to-top:hover, .back-to-top:focus {
            background: var(--primary-dark);
            transform: translateY(-3px);
            outline: none;
            box-shadow: var(--shadow-lg);
        }

        /* تأثيرات للرسوم المتحركة المحسنة */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .slide-in-left {
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .bounce {
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            80% {
                transform: translateY(-5px);
            }
        }

        /* تحسينات للوصول */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* تحسينات للشاشات الصغيرة */
        @media (max-width: 480px) {
            .header-nav {
                flex-direction: column;
                gap: 10px;
            }
            
            .progress-container {
                width: 100%;
                margin: 10px 0;
            }
            
            .story-main {
                margin-top: 140px;
            }
            
            .final-cta {
                flex-direction: column;
            }
            
            .cta-btn {
                width: 100%;
            }
            
            .mobile-controls {
                bottom: 10px;
                padding: 8px 16px;
            }
            
            .scene-title {
                font-size: 1.8rem;
            }
        }

        /* مؤشر التحميل */
        .loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--bg-light);
            z-index: 9999;
            display: none;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* تأثيرات الخلفية الديناميكية */
        .scene-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            opacity: 0.1;
            background-size: cover;
            background-position: center;
        }

        #scene1 .scene-background {
            background: radial-gradient(circle, var(--primary-color) 0%, transparent 70%);
        }

        #scene2 .scene-background {
            background: linear-gradient(45deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        #scene3 .scene-background {
            background: linear-gradient(135deg, #888 0%, #555 100%);
        }

        #scene4 .scene-background {
            background: linear-gradient(45deg, var(--secondary-color) 0%, var(--primary-color) 100%);
        }

        #scene5 .scene-background {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
        }

        #scene6 .scene-background {
            background: radial-gradient(circle, var(--primary-color) 0%, var(--accent-color) 100%);
        }
    </style>
</head>
<body>
    <!-- مؤشر التحميل -->
    <div class="loading-indicator" id="loadingIndicator">
        <div class="loading-bar" id="loadingBar"></div>
    </div>

    <!-- High Contrast Toggle -->
    <button class="a11y-toggle" id="highContrastToggle" aria-label="تبديل وضع التباين العالي">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="currentColor"/>
            <path d="M12 4V6" stroke="currentColor" stroke-width="2"/>
            <path d="M12 18V20" stroke="currentColor" stroke-width="2"/>
            <path d="M4 12H6" stroke="currentColor" stroke-width="2"/>
            <path d="M18 12H20" stroke="currentColor" stroke-width="2"/>
        </svg>
    </button>

    <!-- Header with Progress -->
    <header class="story-header" role="banner">
        <nav class="header-nav" aria-label="التنقل الرئيسي">
            <button class="skip-btn" id="skipStory">تخطي القصة</button>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill"></div>
                </div>
                <div class="scene-indicators" id="sceneIndicators">
                    <button class="scene-dot active" data-scene="1" aria-label="المشهد 1"></button>
                    <button class="scene-dot" data-scene="2" aria-label="المشهد 2"></button>
                    <button class="scene-dot" data-scene="3" aria-label="المشهد 3"></button>
                    <button class="scene-dot" data-scene="4" aria-label="المشهد 4"></button>
                    <button class="scene-dot" data-scene="5" aria-label="المشهد 5"></button>
                    <button class="scene-dot" data-scene="6" aria-label="المشهد 6"></button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="story-main" id="mainContent">
        <!-- Scene 1: Introduction -->
        <section class="story-scene active" id="scene1" data-scene="1">
            <div class="scene-background"></div>
            <div class="scene-content">
                <div class="visual-container">
                    <div class="lottie-placeholder" id="lottie-scene1">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNTAiIGZpbGw9IiNGRkU2MDAiLz4KPHBhdGggZD0iTTE1MCAxMDBMMjUwIDEwMEwyMDAgMjAwTDE1MCAxMDBaIiBmaWxsPSIjRkZCODQwIi8+CjxjaXJjbGUgY3g9IjE4MCIgY3k9IjEzMCIgcj0iNSIgZmlsbD0iIzMzMyIvPgo8Y2lyY2xlIGN4PSIyMjAiIGN5PSIxMzAiIHI9IjUiIGZpbGw9IiMzMzMiLz4KPHBhdGggZD0iTTE4NSAxNjBDMTg1IDE2MCAyMDAgMTcwIDIxNSAxNjAiIHN0cm9rZT0iIzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjwvc3ZnPgo=" alt="سولي - شعاع شمس صغير ومغامر" class="fallback-svg">
                    </div>
                </div>
                <div class="text-container">
                    <h1 class="scene-title">سولي — شعاع شمس صغير ومغامر</h1>
                    <div class="audio-controls">
                        <button class="play-btn" data-audio="scene1" aria-label="تشغيل الصوت للمشهد 1">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <div class="audio-waveform">
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                        </div>
                    </div>
                    <div class="captions" id="captions1">مرحباً! أنا سولي، شعاع شمس صغير ومغامر. اليوم سأخوض مغامرة رائعة!</div>
                    <div class="hotspot-area">
                        <button class="hotspot" data-hotspot="1" aria-label="معلومة اضافية">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                                <text x="10" y="14" text-anchor="middle" fill="white" font-size="12">i</text>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="hotspot-card" id="hotspot1-card">
                <button class="close-hotspot" aria-label="إغلاق">×</button>
                <h3>معلومة عن أشعة الشمس</h3>
                <p>أشعة الشمس تحتوي على فيتامين د المهم لصحة العظام والمناعة.</p>
            </div>
        </section>

        <!-- Scene 2: Discovery -->
        <section class="story-scene" id="scene2" data-scene="2">
            <div class="scene-background"></div>
            <div class="scene-content">
                <div class="visual-container">
                    <div class="lottie-placeholder" id="lottie-scene2">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNTAiIGZpbGw9IiNGRkU2MDAiLz4KPHJlY3QgeD0iMTAwIiB5PSIyMDAiIHdpZHRoPSIyMDAiIGhlaWdodD0iODAiIGZpbGw9IiM3RUJGQzAiLz4KPHJlY3QgeD0iMTIwIiB5PSIyMjAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0iI0ZGRiIvPgo8cmVjdCB4PSIyNDAiIHk9IjIyMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRkZGIi8+Cjwvc3ZnPgo=" alt="سولي يكتشف الأرض والناس" class="fallback-svg">
                    </div>
                </div>
                <div class="text-container">
                    <h2 class="scene-title">اكتشاف الأرض</h2>
                    <div class="audio-controls">
                        <button class="play-btn" data-audio="scene2" aria-label="تشغيل الصوت للمشهد 2">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <div class="audio-waveform">
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                        </div>
                    </div>
                    <div class="captions" id="captions2">ها أنا أصل إلى الأرض! أرى الكثير من الناس والمنازل. إنه عالم رائع!</div>
                    <div class="hotspot-area">
                        <button class="hotspot" data-hotspot="2-1" aria-label="معلومة اضافية 1">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                                <text x="10" y="14" text-anchor="middle" fill="white" font-size="12">i</text>
                            </svg>
                        </button>
                        <button class="hotspot" data-hotspot="2-2" aria-label="معلومة اضافية 2">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                                <text x="10" y="14" text-anchor="middle" fill="white" font-size="12">i</text>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="hotspot-card" id="hotspot2-1-card">
                <button class="close-hotspot" aria-label="إغلاق">×</button>
                <h3>اكتشاف البشر</h3>
                <p>يتفاعل البشر مع أشعة الشمس بشكل مختلف حسب لون بشرتهم.</p>
            </div>
            <div class="hotspot-card" id="hotspot2-2-card">
                <button class="close-hotspot" aria-label="إغلاق">×</button>
                <h3>فوائد الشمس</h3>
                <p>الشمس تساعد النباتات على النمو عبر عملية البناء الضوئي.</p>
            </div>
        </section>

        <!-- Scene 3: The Challenge -->
        <section class="story-scene" id="scene3" data-scene="3">
            <div class="scene-background"></div>
            <div class="scene-content">
                <div class="visual-container">
                    <div class="lottie-placeholder" id="lottie-scene3">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNTAiIGZpbGw9IiNGRkU2MDAiLz4KPGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI0MCIgZmlsbD0iI0E5QTlBOSIvPgo8Y2lyY2xlIGN4PSIzMDAiIGN5PSI4MCIgcj0iNjAiIGZpbGw9IiM4ODgiLz4KPGNpcmNsZSBjeD0iMTUwIiBjeT0iNjAiIHI9IjMwIiBmaWxsPSIjQjlCOUI5Ii8+Cjwvc3ZnPgo=" alt="سولي يواجه سحابة نوكس" class="fallback-svg">
                    </div>
                </div>
                <div class="text-container">
                    <h2 class="scene-title">التحدي</h2>
                    <div class="audio-controls">
                        <button class="play-btn" data-audio="scene3" aria-label="تشغيل الصوت للمشهد 3">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <div class="audio-waveform">
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                        </div>
                    </div>
                    <div class="captions" id="captions3">أوه لا! سحابة نوكس تحاول منعي من الوصول إلى الأرض. يجب أن أجد طريقة للتغلب عليها!</div>
                    <div class="hotspot-area">
                        <button class="hotspot" data-hotspot="3" aria-label="معلومة اضافية">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
                                <text x="10" y="14" text-anchor="middle" fill="white" font-size="12">i</text>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="hotspot-card" id="hotspot3-card">
                <button class="close-hotspot" aria-label="إغلاق">×</button>
                <h3>سحابة نوكس</h3>
                <p>تمثل السحب والعواصف تحدياً لأشعة الشمس في الوصول للأرض.</p>
            </div>
        </section>

        <!-- Scene 4: Journey -->
        <section class="story-scene" id="scene4" data-scene="4">
            <div class="scene-background"></div>
            <div class="scene-content">
                <div class="visual-container">
                    <div class="lottie-placeholder" id="lottie-scene4">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNTAiIGZpbGw9IiNGRkU2MDAiLz4KPHJlY3QgeD0iMTUwIiB5PSIxMDAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRkZGIiBzdHJva2U9IiMzMzMiIHN0cm9rZS13aWR0aD0iMiIvPgo8cmVjdCB4PSIxNzAiIHk9IjEyMCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjRkZFNjAwIi8+CjxjaXJjbGUgY3g9IjE5MCIgY3k9IjE2MCIgcj0iMTUiIGZpbGw9IiNGRkU2MDAiLz4KPHJlY3QgeD0iMTcwIiB5PSIxODAiIHdpZHRoPSI2MCIgaGVpZ2h0PSIyMCIgZmlsbD0iI0ZGRTYwMCIvPgo8L3N2Zz4K" alt="سولي يبني الدرع الواقي" class="fallback-svg">
                    </div>
                </div>
                <div class="text-container">
                    <h2 class="scene-title">الرحلة والتعلم</h2>
                    <div class="audio-controls">
                        <button class="play-btn" data-audio="scene4" aria-label="تشغيل الصوت للمشهد 4">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <div class="audio-waveform">
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                        </div>
                    </div>
                    <div class="captions" id="captions4">سأبني درعاً واقياً يساعدني على مواجهة سحابة نوكس. سأحتاج إلى القاعدة والنواة والغطاء.</div>
                    
                    <!-- Mini-game: Shield Builder -->
                    <div class="minigame-container" id="shieldGame">
                        <h3>ابنِ الدرع الواقي</h3>
                        <div class="shield-parts">
                            <div class="shield-part" data-part="base" draggable="true">
                                <span>القاعدة</span>
                            </div>
                            <div class="shield-part" data-part="core" draggable="true">
                                <span>النواة</span>
                            </div>
                            <div class="shield-part" data-part="cover" draggable="true">
                                <span>الغطاء</span>
                            </div>
                        </div>
                        <div class="shield-assembly">
                            <div class="assembly-area" id="assemblyArea">
                                <p>اسحب الأجزاء هنا لبناء الدرع</p>
                            </div>
                        </div>
                        <!-- Fallback for non-JS/drag support -->
                        <div class="shield-fallback">
                            <button class="shield-step" data-step="1">الخطوة الأولى</button>
                            <button class="shield-step" data-step="2">الخطوة الثانية</button>
                            <button class="shield-step" data-step="3">الخطوة الثالثة</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Scene 5: Climax -->
        <section class="story-scene" id="scene5" data-scene="5">
            <div class="scene-background"></div>
            <div class="scene-content">
                <div class="visual-container">
                    <div class="lottie-placeholder" id="lottie-scene5">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNTAiIGZpbGw9IiNGRkU2MDAiLz4KPHBhdGggZD0iTTEwMCA1MEwyMDAgMTUwTDEwMCAyNTBaIiBmaWxsPSIjODg4IiBvcGFjaXR5PSIwLjciLz4KPHBhdGggZD0iTTMwMCA1MEwyMDAgMTUwTDMwMCAyNTBaIiBmaWxsPSIjODg4IiBvcGFjaXR5PSIwLjciLz4KPGNpcmNsZSBjeD0iMTUwIiBjeT0iMTAwIiByPSIxNSIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPGNpcmNsZSBjeD0iMTUwIiBjeT0iMjAwIiByPSIxNSIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPGNpcmNsZSBjeD0iMjUwIiBjeT0iMTAwIiByPSIxNSIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPGNpcmNsZSBjeD0iMjUwIiBjeT0iMjAwIiByPSIxNSIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjMzMzIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+Cg==" alt="سولي يواجه الموجة الكبيرة" class="fallback-svg">
                    </div>
                    <!-- Interactive targets for energy deflection -->
                    <div class="energy-targets">
                        <button class="energy-target" data-target="1" aria-label="هدف الطاقة 1"></button>
                        <button class="energy-target" data-target="2" aria-label="هدف الطاقة 2"></button>
                        <button class="energy-target" data-target="3" aria-label="هدف الطاقة 3"></button>
                        <button class="energy-target" data-target="4" aria-label="هدف الطاقة 4"></button>
                    </div>
                </div>
                <div class="text-container">
                    <h2 class="scene-title">المواجهة الكبرى</h2>
                    <div class="audio-controls">
                        <button class="play-btn" data-audio="scene5" aria-label="تشغيل الصوت للمشهد 5">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <div class="audio-waveform">
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                        </div>
                    </div>
                    <div class="captions" id="captions5">ها هي الموجة الكبيرة! يجب أن أستخدم درعي لتوجيه الطاقة نحو الأهداف الصحيحة.</div>
                    <div class="interaction-guide">
                        <p>انقر على الأهداف لتوجيه الطاقة!</p>
                    </div>
                </div>
            </div>
            <!-- Success celebration -->
            <div class="celebration" id="celebration">
                <div class="confetti-container"></div>
                <div class="success-message">
                    <h3>أحسنت! نجحت في توجيه الطاقة</h3>
                </div>
            </div>
        </section>

        <!-- Scene 6: Resolution -->
        <section class="story-scene" id="scene6" data-scene="6">
            <div class="scene-background"></div>
            <div class="scene-content">
                <div class="visual-container">
                    <div class="lottie-placeholder" id="lottie-scene6">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNTAiIGZpbGw9IiNGRkU2MDAiLz4KPHBhdGggZD0iTTE1MCAxMDBMMjUwIDEwMEwyMDAgMjAwTDE1MCAxMDBaIiBmaWxsPSIjRkZCODQwIi8+CjxjaXJjbGUgY3g9IjE4MCIgY3k9IjEzMCIgcj0iNSIgZmlsbD0iIzMzMyIvPgo8Y2lyY2xlIGN4PSIyMjAiIGN5PSIxMzAiIHI9IjUiIGZpbGw9IiMzMzMiLz4KPHBhdGggZD0iTTE4NSAxNjBDMTg1IDE2MCAyMDAgMTcwIDIxNSAxNjAiIHN0cm9rZT0iIzMzMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjgwIiByPSIxMCIgZmlsbD0iI0ZGRTYwMCIvPgo8Y2lyY2xlIGN4PSIzMDAiIGN5PSI3MCIgcj0iMTUiIGZpbGw9IiNGRkU2MDAiLz4KPGNpcmNsZSBjeD0iMzUwIiBjeT0iMTIwIiByPSI4IiBmaWxsPSIjRkZFNjAwIi8+CjxjaXJjbGUgY3g9IjUwIiBjeT0iMTUwIiByPSIxMiIgZmlsbD0iI0ZGRTYwMCIvPgo8L3N2Zz4K" alt="سولي يعود منتصراً" class="fallback-svg">
                    </div>
                </div>
                <div class="text-container">
                    <h2 class="scene-title">النهاية السعيدة</h2>
                    <div class="audio-controls">
                        <button class="play-btn" data-audio="scene6" aria-label="تشغيل الصوت للمشهد 6">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <div class="audio-waveform">
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                            <div class="waveform-bar"></div>
                        </div>
                    </div>
                    <div class="captions" id="captions6">لقد نجحت! تغلبت على سحابة نوكس ووصلت إلى الأرض. الآن يمكنني أن أضيء يوم الجميع!</div>
                    
                    <!-- Final CTA -->
                    <div class="final-cta">
                        <button class="cta-btn download-btn" id="downloadGame">
                            حمّل اللعبة
                        </button>
                        <button class="cta-btn quiz-btn" id="takeQuiz">
                            اختبر معلوماتك
                        </button>
                        <button class="cta-btn replay-btn" id="replayStory">
                            أعِد المشاهدة
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Mobile Controls -->
    <div class="mobile-controls" id="mobileControls">
        <button class="mobile-btn" id="mobilePlayPause" aria-label="تشغيل/إيقاف الصوت">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
            </svg>
        </button>
        <button class="mobile-btn" id="mobileCaptionsToggle" aria-label="تبديل الترجمة">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 7h2v2H7V7zm0 4h2v2H7v-2zm0 4h2v2H7v-2zm10 4H11v-2h6v2zm0-4H11v-2h6v2zm0-4H11V7h6v2z"/>
            </svg>
        </button>
        <button class="mobile-btn" id="mobileSkipQuiz" aria-label="تخطي إلى الاختبار">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M5.88 4.12L13.76 12l-7.88 7.88L8 22l10-10L8 2z"/>
            </svg>
        </button>
    </div>

    <!-- Full Transcript -->
    <section class="transcript-section" id="transcript">
        <div class="container">
            <h2>النص الكامل للقصة</h2>
            <div class="transcript-content" id="transcriptContent">
                <!-- Transcript will be loaded here from SRT file -->
                <p><strong>المشهد 1:</strong> مرحباً! أنا سولي، شعاع شمس صغير ومغامر. اليوم سأخوض مغامرة رائعة!</p>
                <p><strong>المشهد 2:</strong> ها أنا أصل إلى الأرض! أرى الكثير من الناس والمنازل. إنه عالم رائع!</p>
                <p><strong>المشهد 3:</strong> أوه لا! سحابة نوكس تحاول منعي من الوصول إلى الأرض. يجب أن أجد طريقة للتغلب عليها!</p>
                <p><strong>المشهد 4:</strong> سأبني درعاً واقياً يساعدني على مواجهة سحابة نوكس. سأحتاج إلى القاعدة والنواة والغطاء.</p>
                <p><strong>المشهد 5:</strong> ها هي الموجة الكبيرة! يجب أن أستخدم درعي لتوجيه الطاقة نحو الأهداف الصحيحة.</p>
                <p><strong>المشهد 6:</strong> لقد نجحت! تغلبت على سحابة نوكس ووصلت إلى الأرض. الآن يمكنني أن أضيء يوم الجميع!</p>
            </div>
            <button class="back-to-top" id="backToTop">العودة للأعلى</button>
        </div>
    </section>

    <!-- Audio Elements -->
    <audio id="audioScene1" preload="none">
        <source src="#" type="audio/mpeg">
    </audio>
    <audio id="audioScene2" preload="none">
        <source src="#" type="audio/mpeg">
    </audio>
    <audio id="audioScene3" preload="none">
        <source src="#" type="audio/mpeg">
    </audio>
    <audio id="audioScene4" preload="none">
        <source src="#" type="audio/mpeg">
    </audio>
    <audio id="audioScene5" preload="none">
        <source src="#" type="audio/mpeg">
    </audio>
    <audio id="audioScene6" preload="none">
        <source src="#" type="audio/mpeg">
    </audio>

    <script>
        // JavaScript المحسن للقصة التفاعلية
        
        document.addEventListener('DOMContentLoaded', function() {
            // حالة التطبيق
            const appState = {
                currentScene: 1,
                totalScenes: 6,
                audioPlaying: false,
                currentAudio: null,
                highContrast: false,
                captionsEnabled: true,
                shieldBuilt: false,
                targetsHit: 0,
                totalTargets: 4,
                completedScenes: new Set([1])
            };
        
            // عناصر DOM الرئيسية
            const elements = {
                mainContent: document.getElementById('mainContent'),
                progressFill: document.querySelector('.progress-fill'),
                sceneIndicators: document.getElementById('sceneIndicators'),
                highContrastToggle: document.getElementById('highContrastToggle'),
                skipStory: document.getElementById('skipStory'),
                mobilePlayPause: document.getElementById('mobilePlayPause'),
                mobileCaptionsToggle: document.getElementById('mobileCaptionsToggle'),
                mobileSkipQuiz: document.getElementById('mobileSkipQuiz'),
                backToTop: document.getElementById('backToTop'),
                transcriptContent: document.getElementById('transcriptContent'),
                downloadGame: document.getElementById('downloadGame'),
                takeQuiz: document.getElementById('takeQuiz'),
                replayStory: document.getElementById('replayStory'),
                loadingIndicator: document.getElementById('loadingIndicator'),
                loadingBar: document.getElementById('loadingBar')
            };
        
            // تهيئة التطبيق
            function initApp() {
                setupEventListeners();
                setupDragAndDrop();
                setupHotspots();
                updateProgressBar();
                checkDragSupport();
                loadPreferences();
                
                // إضافة تأثيرات دخول للمشهد الأول
                const firstScene = document.getElementById('scene1');
                firstScene.classList.add('fade-in');
                
                // إظهار مؤشر التحميل مؤقتاً
                showLoadingIndicator();
                setTimeout(hideLoadingIndicator, 1000);
            }
        
            // إعداد مستمعي الأحداث
            function setupEventListeners() {
                // تبديل وضع التباين العالي
                elements.highContrastToggle.addEventListener('click', toggleHighContrast);
                
                // تخطي القصة
                elements.skipStory.addEventListener('click', skipToEnd);
                
                // التنقل بين المشاهد
                elements.sceneIndicators.addEventListener('click', function(e) {
                    if (e.target.classList.contains('scene-dot')) {
                        const sceneNumber = parseInt(e.target.dataset.scene);
                        navigateToScene(sceneNumber);
                    }
                });
                
                // أزرار التشغيل للصوت
                document.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const sceneNumber = this.dataset.audio.replace('scene', '');
                        toggleAudio(sceneNumber);
                    });
                });
                
                // عناصر التحكم للجوال
                elements.mobilePlayPause.addEventListener('click', toggleMobileAudio);
                elements.mobileCaptionsToggle.addEventListener('click', toggleCaptions);
                elements.mobileSkipQuiz.addEventListener('click', skipToQuiz);
                
                // العودة للأعلى
                elements.backToTop.addEventListener('click', scrollToTop);
                
                // أزرار النداء للعمل
                elements.downloadGame.addEventListener('click', downloadGame);
                elements.takeQuiz.addEventListener('click', takeQuiz);
                elements.replayStory.addEventListener('click', replayStory);
                
                // أهداف الطاقة
                document.querySelectorAll('.energy-target').forEach(target => {
                    target.addEventListener('click', handleEnergyTargetClick);
                });
                
                // إغلاق بطاقات المعلومات التفاعلية
                document.querySelectorAll('.close-hotspot').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const card = this.closest('.hotspot-card');
                        card.style.display = 'none';
                    });
                });
                
                // التعامل مع نهاية الصوت
                document.querySelectorAll('audio').forEach(audio => {
                    audio.addEventListener('ended', handleAudioEnded);
                    audio.addEventListener('timeupdate', handleAudioTimeUpdate);
                });
                
                // التعامل مع مفاتيح لوحة المفاتيح
                document.addEventListener('keydown', handleKeyPress);
                
                // التعامل مع السحب والإفلات
                document.addEventListener('dragover', handleDragOver);
                document.addEventListener('drop', handleDrop);
                
                // التعامل مع التمرير
                document.addEventListener('wheel', handleWheel, { passive: false });
                
                // التعامل مع تغيير حجم النافذة
                window.addEventListener('resize', handleResize);
            }
        
            // إعداد النقاط التفاعلية
            function setupHotspots() {
                document.querySelectorAll('.hotspot').forEach(hotspot => {
                    hotspot.addEventListener('click', function() {
                        const hotspotId = this.dataset.hotspot;
                        const card = document.getElementById(`hotspot${hotspotId}-card`);
                        
                        if (card) {
                            // إخفاء جميع البطاقات أولاً
                            document.querySelectorAll('.hotspot-card').forEach(c => {
                                c.style.display = 'none';
                            });
                            
                            // إظهار البطاقة المحددة
                            card.style.display = 'block';
                            
                            // وضع البطاقة بجانب النقطة التفاعلية
                            const rect = this.getBoundingClientRect();
                            card.style.top = `${rect.top + window.scrollY}px`;
                            card.style.left = `${rect.left + window.scrollX - 320}px`;
                            
                            // إغلاق البطاقة عند النقر خارجها
                            setTimeout(() => {
                                document.addEventListener('click', closeHotspotOnClickOutside);
                            }, 10);
                        }
                    });
                });
            }
        
            // إغلاق البطاقة عند النقر خارجها
            function closeHotspotOnClickOutside(e) {
                if (!e.target.closest('.hotspot-card') && !e.target.closest('.hotspot')) {
                    document.querySelectorAll('.hotspot-card').forEach(card => {
                        card.style.display = 'none';
                    });
                    document.removeEventListener('click', closeHotspotOnClickOutside);
                }
            }
        
            // إعداد السحب والإفلات
            function setupDragAndDrop() {
                document.querySelectorAll('.shield-part').forEach(part => {
                    part.addEventListener('dragstart', handleDragStart);
                });
                
                const assemblyArea = document.getElementById('assemblyArea');
                if (assemblyArea) {
                    assemblyArea.addEventListener('dragover', handleDragOver);
                    assemblyArea.addEventListener('drop', handleShieldPartDrop);
                }
            }
        
            // التحقق من دعم السحب والإفلات
            function checkDragSupport() {
                const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints;
                if (isTouchDevice) {
                    document.body.classList.add('no-drag');
                }
            }
        
            // التنقل بين المشاهد
            function navigateToScene(sceneNumber) {
                if (sceneNumber < 1 || sceneNumber > appState.totalScenes) return;
                
                // إظهار مؤشر التحميل
                showLoadingIndicator();
                
                // إيقاف الصوت الحالي
                if (appState.audioPlaying && appState.currentAudio) {
                    const currentAudio = document.getElementById(`audioScene${appState.currentAudio}`);
                    if (currentAudio) {
                        currentAudio.pause();
                        currentAudio.currentTime = 0;
                    }
                    appState.audioPlaying = false;
                }
                
                // تحديث المشاهد المكتملة
                appState.completedScenes.add(sceneNumber);
                
                // إخفاء المشهد الحالي
                const currentScene = document.querySelector('.story-scene.active');
                if (currentScene) {
                    currentScene.classList.remove('active');
                }
                
                // إظهار المشهد الجديد بعد تأخير بسيط
                setTimeout(() => {
                    const newScene = document.getElementById(`scene${sceneNumber}`);
                    if (newScene) {
                        newScene.classList.add('active');
                        
                        // إضافة تأثيرات دخول مختلفة
                        if (sceneNumber % 2 === 0) {
                            newScene.classList.add('slide-in-right');
                        } else {
                            newScene.classList.add('slide-in-left');
                        }
                        
                        // إزالة تأثيرات الدخول بعد الانتهاء
                        setTimeout(() => {
                            newScene.classList.remove('slide-in-right', 'slide-in-left');
                        }, 500);
                    }
                    
                    // تحديث حالة التطبيق
                    appState.currentScene = sceneNumber;
                    
                    // تحديث شريط التقدم
                    updateProgressBar();
                    
                    // تحديث مؤشرات المشاهد
                    updateSceneIndicators();
                    
                    // إذا كان المشهد يحتوي على لعبة مصغرة، قم بتهيئتها
                    if (sceneNumber === 4 && !appState.shieldBuilt) {
                        initShieldGame();
                    }
                    
                    // إذا كان المشهد يحتوي على أهداف الطاقة، قم بتهيئتها
                    if (sceneNumber === 5) {
                        initEnergyTargets();
                    }
                    
                    // إخفاء مؤشر التحميل
                    hideLoadingIndicator();
                }, 300);
            }
        
            // تحديث شريط التقدم
            function updateProgressBar() {
                const progressPercentage = (appState.currentScene / appState.totalScenes) * 100;
                elements.progressFill.style.width = `${progressPercentage}%`;
            }
        
            // تحديث مؤشرات المشاهد
            function updateSceneIndicators() {
                document.querySelectorAll('.scene-dot').forEach((dot, index) => {
                    const sceneNumber = index + 1;
                    if (sceneNumber === appState.currentScene) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                    
                    if (appState.completedScenes.has(sceneNumber)) {
                        dot.classList.add('completed');
                    }
                });
            }
        
            // تبديل وضع التباين العالي
            function toggleHighContrast() {
                appState.highContrast = !appState.highContrast;
                document.body.classList.toggle('high-contrast', appState.highContrast);
                
                // تأثير مرئي للتبديل
                elements.highContrastToggle.classList.add('bounce');
                setTimeout(() => {
                    elements.highContrastToggle.classList.remove('bounce');
                }, 500);
                
                // حفظ التفضيل في localStorage
                localStorage.setItem('highContrast', appState.highContrast);
            }
        
            // تبديل الصوت
            function toggleAudio(sceneNumber) {
                const audio = document.getElementById(`audioScene${sceneNumber}`);
                const playBtn = document.querySelector(`.play-btn[data-audio="scene${sceneNumber}"]`);
                
                if (!audio) return;
                
                if (appState.audioPlaying && appState.currentAudio === sceneNumber) {
                    // إيقاف الصوت الحالي
                    audio.pause();
                    appState.audioPlaying = false;
                    playBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
                } else {
                    // إيقاف أي صوت آخر
                    if (appState.currentAudio && appState.currentAudio !== sceneNumber) {
                        const prevAudio = document.getElementById(`audioScene${appState.currentAudio}`);
                        const prevBtn = document.querySelector(`.play-btn[data-audio="scene${appState.currentAudio}"]`);
                        
                        if (prevAudio) {
                            prevAudio.pause();
                            prevAudio.currentTime = 0;
                        }
                        
                        if (prevBtn) {
                            prevBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
                        }
                    }
                    
                    // تشغيل الصوت الجديد
                    audio.play().catch(e => {
                        console.error('Error playing audio:', e);
                    });
                    appState.audioPlaying = true;
                    appState.currentAudio = sceneNumber;
                    playBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M6 4h4v16H6zM14 4h4v16h-4z"/></svg>';
                    
                    // محاكاة موجة الصوت
                    animateWaveform();
                }
            }
        
            // التعامل مع تحديث وقت الصوت
            function handleAudioTimeUpdate(e) {
                const audio = e.target;
                const sceneNumber = audio.id.replace('audioScene', '');
                const caption = document.getElementById(`captions${sceneNumber}`);
                
                if (caption && appState.captionsEnabled) {
                    // إضافة تأثير تمييز للترجمة عند التشغيل
                    caption.classList.add('highlight');
                    setTimeout(() => {
                        caption.classList.remove('highlight');
                    }, 1000);
                }
            }
        
            // تبديل الصوت للجوال
            function toggleMobileAudio() {
                if (appState.audioPlaying && appState.currentAudio) {
                    toggleAudio(appState.currentAudio);
                } else {
                    toggleAudio(appState.currentScene);
                }
            }
        
            // التعامل مع نهاية الصوت
            function handleAudioEnded(e) {
                const audioId = e.target.id;
                const sceneNumber = audioId.replace('audioScene', '');
                const playBtn = document.querySelector(`.play-btn[data-audio="scene${sceneNumber}"]`);
                
                if (playBtn) {
                    playBtn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
                }
                
                appState.audioPlaying = false;
                
                // الانتقال التلقائي للمشهد التالي
                if (parseInt(sceneNumber) < appState.totalScenes) {
                    setTimeout(() => {
                        navigateToScene(parseInt(sceneNumber) + 1);
                    }, 1000);
                }
            }
        
            // محاكاة موجة الصوت
            function animateWaveform() {
                const bars = document.querySelectorAll('.waveform-bar');
                bars.forEach(bar => {
                    bar.style.animation = 'none';
                    setTimeout(() => {
                        bar.style.animation = 'waveform 1.5s ease-in-out infinite';
                    }, 10);
                });
            }
        
            // تبديل الترجمة
            function toggleCaptions() {
                appState.captionsEnabled = !appState.captionsEnabled;
                document.querySelectorAll('.captions').forEach(caption => {
                    caption.style.display = appState.captionsEnabled ? 'flex' : 'none';
                });
                
                // تأثير مرئي للتبديل
                elements.mobileCaptionsToggle.classList.add('bounce');
                setTimeout(() => {
                    elements.mobileCaptionsToggle.classList.remove('bounce');
                }, 500);
            }
        
            // تخطي إلى النهاية
            function skipToEnd() {
                navigateToScene(appState.totalScenes);
            }
        
            // تخطي إلى الاختبار
            function skipToQuiz() {
                // في التطبيق الحقيقي، سيتم توجيه المستخدم إلى صفحة الاختبار
                alert('سيتم توجيهك إلى صفحة الاختبار في التطبيق الكامل');
            }
        
            // التمرير إلى الأعلى
            function scrollToTop() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }
        
            // تحميل اللعبة
            function downloadGame() {
                // في التطبيق الحقيقي، سيبدأ تحميل اللعبة
                alert('سيبدأ تحميل اللعبة في التطبيق الكامل');
            }
        
            // أخذ الاختبار
            function takeQuiz() {
                // في التطبيق الحقيقي، سيتم توجيه المستخدم إلى صفحة الاختبار
                alert('سيتم توجيهك إلى صفحة الاختبار في التطبيق الكامل');
            }
        
            // إعادة مشاهدة القصة
            function replayStory() {
                navigateToScene(1);
                appState.shieldBuilt = false;
                appState.targetsHit = 0;
                appState.completedScenes = new Set([1]);
                
                // إعادة تعيين لعبة بناء الدرع
                const assemblyArea = document.getElementById('assemblyArea');
                if (assemblyArea) {
                    assemblyArea.innerHTML = '<p>اسحب الأجزاء هنا لبناء الدرع</p>';
                    assemblyArea.classList.remove('complete');
                }
                
                // إعادة تعيين أهداف الطاقة
                document.querySelectorAll('.energy-target').forEach(target => {
                    target.classList.remove('active', 'hit');
                });
                
                // إخفاء احتفال النجاح
                const celebration = document.getElementById('celebration');
                if (celebration) {
                    celebration.style.display = 'none';
                }
            }
        
            // تهيئة لعبة بناء الدرع
            function initShieldGame() {
                // تفعيل الحاوية
                const minigameContainer = document.getElementById('shieldGame');
                minigameContainer.classList.add('active');
                
                // إضافة مستمعي الأحداث للأزرار البديلة
                document.querySelectorAll('.shield-step').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const step = parseInt(this.dataset.step);
                        buildShieldStep(step);
                    });
                });
            }
        
            // بناء الدرع خطوة بخطوة
            function buildShieldStep(step) {
                const assemblyArea = document.getElementById('assemblyArea');
                
                switch(step) {
                    case 1:
                        assemblyArea.innerHTML = '<div class="shield-part" data-part="base"><span>القاعدة</span></div>';
                        break;
                    case 2:
                        assemblyArea.innerHTML = '<div class="shield-part" data-part="base"><span>القاعدة</span></div><div class="shield-part" data-part="core"><span>النواة</span></div>';
                        break;
                    case 3:
                        assemblyArea.innerHTML = '<div class="shield-part" data-part="base"><span>القاعدة</span></div><div class="shield-part" data-part="core"><span>النواة</span></div><div class="shield-part" data-part="cover"><span>الغطاء</span></div>';
                        assemblyArea.classList.add('complete');
                        appState.shieldBuilt = true;
                        
                        // الانتقال التلقائي للمشهد التالي بعد ثانيتين
                        setTimeout(() => {
                            navigateToScene(5);
                        }, 2000);
                        break;
                }
            }
        
            // التعامل مع بدء السحب
            function handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.part);
                e.target.classList.add('dragging');
            }
        
            // التعامل مع السحب فوق منطقة الهدف
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            }
        
            // التعامل مع إفلات جزء الدرع
            function handleShieldPartDrop(e) {
                e.preventDefault();
                const partType = e.dataTransfer.getData('text/plain');
                const draggedElement = document.querySelector(`.shield-part[data-part="${partType}"]`);
                
                if (draggedElement) {
                    const assemblyArea = document.getElementById('assemblyArea');
                    
                    // إنشاء نسخة من العنصر المسحوب
                    const clonedPart = draggedElement.cloneNode(true);
                    clonedPart.classList.remove('dragging');
                    clonedPart.draggable = false;
                    
                    // إضافة الجزء إلى منطقة التجميع
                    assemblyArea.appendChild(clonedPart);
                    
                    // التحقق مما إذا كان الدرع مكتملاً
                    checkShieldCompletion();
                }
            }
        
            // التحقق من اكتمال بناء الدرع
            function checkShieldCompletion() {
                const assemblyArea = document.getElementById('assemblyArea');
                const parts = assemblyArea.querySelectorAll('.shield-part');
                
                if (parts.length === 3) {
                    assemblyArea.classList.add('complete');
                    appState.shieldBuilt = true;
                    
                    // الانتقال التلقائي للمشهد التالي بعد ثانيتين
                    setTimeout(() => {
                        navigateToScene(5);
                    }, 2000);
                }
            }
        
            // تهيئة أهداف الطاقة
            function initEnergyTargets() {
                // تفعيل الأهداف بشكل عشوائي
                const targets = document.querySelectorAll('.energy-target');
                let activeTargets = 0;
                
                const activateRandomTarget = () => {
                    if (activeTargets >= 2 || appState.targetsHit >= appState.totalTargets) return;
                    
                    const inactiveTargets = Array.from(targets).filter(t => !t.classList.contains('active') && !t.classList.contains('hit'));
                    if (inactiveTargets.length > 0) {
                        const randomTarget = inactiveTargets[Math.floor(Math.random() * inactiveTargets.length)];
                        randomTarget.classList.add('active');
                        activeTargets++;
                        
                        // إلغاء تفعيل الهدف بعد فترة
                        setTimeout(() => {
                            if (randomTarget.classList.contains('active') && !randomTarget.classList.contains('hit')) {
                                randomTarget.classList.remove('active');
                                activeTargets--;
                            }
                        }, 3000);
                    }
                };
                
                // تفعيل الأهداف بشكل دوري
                const targetInterval = setInterval(activateRandomTarget, 2000);
                
                // إيقاف التفاعل بعد اكتمال المهمة
                const checkCompletion = setInterval(() => {
                    if (appState.targetsHit >= appState.totalTargets) {
                        clearInterval(targetInterval);
                        clearInterval(checkCompletion);
                        
                        // إظهار احتفال النجاح
                        const celebration = document.getElementById('celebration');
                        if (celebration) {
                            celebration.style.display = 'flex';
                            createConfetti();
                            
                            // الانتقال التلقائي للمشهد التالي بعد 3 ثوان
                            setTimeout(() => {
                                navigateToScene(6);
                            }, 3000);
                        }
                    }
                }, 500);
            }
        
            // التعامل مع النقر على أهداف الطاقة
            function handleEnergyTargetClick(e) {
                const target = e.target;
                
                if (target.classList.contains('active') && !target.classList.contains('hit')) {
                    target.classList.remove('active');
                    target.classList.add('hit');
                    appState.targetsHit++;
                    
                    // تأثير بصري عند النقر
                    target.style.transform = 'scale(1.5)';
                    target.style.backgroundColor = '#4CAF50';
                    
                    setTimeout(() => {
                        target.style.transform = 'scale(1)';
                    }, 300);
                }
            }
        
            // إنشاء تأثير الكونفيتي
            function createConfetti() {
                const confettiContainer = document.querySelector('.confetti-container');
                const colors = ['#FFA500', '#4A90E2', '#FF6B6B', '#4CAF50', '#9C27B0'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.position = 'absolute';
                    confetti.style.top = '-10px';
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.opacity = Math.random() * 0.5 + 0.5;
                    
                    confettiContainer.appendChild(confetti);
                    
                    // تحريك الكونفيتي
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 3000 + 2000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                    });
                    
                    // إزالة الكونفيتي بعد انتهاء الحركة
                    animation.onfinish = () => {
                        confetti.remove();
                    };
                }
            }
        
            // التعامل مع ضغطات المفاتيح
            function handleKeyPress(e) {
                // مفتاح المسافة لتشغيل/إيقاف الصوت
                if (e.code === 'Space') {
                    e.preventDefault();
                    toggleMobileAudio();
                }
                
                // مفاتيح الأسهم للتنقل بين المشاهد
                if (e.code === 'ArrowRight' || e.code === 'ArrowDown') {
                    e.preventDefault();
                    if (appState.currentScene < appState.totalScenes) {
                        navigateToScene(appState.currentScene + 1);
                    }
                }
                
                if (e.code === 'ArrowLeft' || e.code === 'ArrowUp') {
                    e.preventDefault();
                    if (appState.currentScene > 1) {
                        navigateToScene(appState.currentScene - 1);
                    }
                }
                
                // مفتاح H لتبديل وضع التباين العالي
                if (e.code === 'KeyH') {
                    e.preventDefault();
                    toggleHighContrast();
                }
                
                // مفتاح C لتبديل الترجمة
                if (e.code === 'KeyC') {
                    e.preventDefault();
                    toggleCaptions();
                }
            }
        
            // التعامل مع التمرير
            function handleWheel(e) {
                // منع التمرير الافتراضي
                e.preventDefault();
                
                // تحديد الاتجاه بناءً على قيمة deltaY
                if (e.deltaY > 0 && appState.currentScene < appState.totalScenes) {
                    // التمرير لأسفل - الانتقال للمشهد التالي
                    navigateToScene(appState.currentScene + 1);
                } else if (e.deltaY < 0 && appState.currentScene > 1) {
                    // التمرير لأعلى - الانتقال للمشهد السابق
                    navigateToScene(appState.currentScene - 1);
                }
            }
        
            // التعامل مع تغيير حجم النافذة
            function handleResize() {
                // إعادة حساب مواقع النقاط التفاعلية
                document.querySelectorAll('.hotspot-card').forEach(card => {
                    card.style.display = 'none';
                });
            }
        
            // إظهار مؤشر التحميل
            function showLoadingIndicator() {
                elements.loadingIndicator.style.display = 'block';
                elements.loadingBar.style.width = '0%';
                
                // محاكاة التقدم
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    elements.loadingBar.style.width = `${progress}%`;
                    
                    if (progress >= 90) {
                        clearInterval(interval);
                    }
                }, 50);
            }
        
            // إخفاء مؤشر التحميل
            function hideLoadingIndicator() {
                elements.loadingBar.style.width = '100%';
                setTimeout(() => {
                    elements.loadingIndicator.style.display = 'none';
                }, 300);
            }
        
            // تحميل التفضيلات المحفوظة
            function loadPreferences() {
                const savedHighContrast = localStorage.getItem('highContrast');
                if (savedHighContrast === 'true') {
                    appState.highContrast = true;
                    document.body.classList.add('high-contrast');
                }
                
                const savedCaptions = localStorage.getItem('captionsEnabled');
                if (savedCaptions !== null) {
                    appState.captionsEnabled = savedCaptions === 'true';
                    document.querySelectorAll('.captions').forEach(caption => {
                        caption.style.display = appState.captionsEnabled ? 'flex' : 'none';
                    });
                }
            }
        
            // حفظ التفضيلات
            function savePreferences() {
                localStorage.setItem('highContrast', appState.highContrast);
                localStorage.setItem('captionsEnabled', appState.captionsEnabled);
            }
        
            // تهيئة التطبيق عند تحميل الصفحة
            initApp();
        });
    </script>
</body>
</html>